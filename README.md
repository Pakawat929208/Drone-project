# EE495 Selected Topic in Electrical Engineering สิ่งที่ได้เรียนรู้ในแต่ละสัปดาห์

## 1.วิเคราะห์โครงสร้างโดรน

โครงสร้างโดรนที่เลือกใช้

โดรนแบบ โดรน 4 ใบพัด (Quadcopter)

![โดรนแบบ โดรน 4 ใบพัด (Quadcopter)](https://github.com/user-attachments/assets/da84bf74-80c6-47f0-9da3-7655a5446b86)

ข้อดี:

1.มีเสถียรภาพสูง, สามารถบรรทุกกล้องขนาดใหญ่หรืออุปกรณ์หนักได้, เวลาบินนานขึ้น (เมื่อใช้แบตเตอรี่ขนาดใหญ่)

2.สมดุลระหว่างขนาดและประสิทธิภาพ, มีพื้นที่ในการติดตั้งอุปกรณ์เสริมพอสมควร, เวลาบินปานกลาง

ข้อเสีย: 

1.ขนาดใหญ่และหนัก, พกพายาก, มีราคาแพงกว่า, การบำรุงรักษาซับซ้อนกว่า

##

## 2.ค้นคว้าเกี่ยวกับ STM32 และการใช้งานเบื้องต้น

### ขั้นตอนการสร้างเอาต์พุตพัลส์สำหรับควบคุม Electronic Speed Controllers (ESCs) โดยใช้ไมโครคอนโทรลเลอร์ STM32F103C8T6 

1.การตั้งค่า Timer: ใช้ Timer ใน STM32F103C8T6 เพื่อสร้างสัญญาณพัลส์ PWM สำหรับควบคุม ESC

2.การกำหนดค่าพอร์ต: กำหนดค่าพอร์ต PB6 เป็นเอาต์พุตสำหรับสัญญาณพัลส์

3.การตรวจสอบสัญญาณ: ตรวจสอบสัญญาณพัลส์ที่ขา PB6 ด้วยออสซิลโลสโคป

4.การควบคุมความเร็ว: ควบคุมความเร็วของมอเตอร์โดยการเปลี่ยนความยาวพัลส์

5.การทำงานร่วมกับ Flight Controller: อ้างอิงจากโปรเจกต์ Arduino Quadcopter และวางแผนพัฒนาโปรแกรม Flight Controller สำหรับบอร์ด Blue Pill และ Flip 32

![ภาพ ตัวอย่าง](https://github.com/user-attachments/assets/4797c6f8-5902-4a26-ac5a-31c80113015c)

แหล่งที่มา https://www.youtube.com/watch?v=Nju9rvZOjVQ&list=PL0K4VDicBzshwCpUHzIB6hOLQVkDFHbxC&index=15
##

## 3.ออกแบบวงจรและ PCB ด้วยEasyeda

แอบที่ใช้ออกแบบ: https://easyeda.com/

ภาพจากการออกแบบ

![บอร์ด PCB](https://github.com/user-attachments/assets/5166fc0f-d9f3-4e1c-88d7-e322ec54ab9a)

ข้อดี

1.การรวมวงจรที่หนาแน่น (High Integration) และขนาดกะทัดรัด: PCB ช่วยให้สามารถจัดวางส่วนประกอบอิเล็กทรอนิกส์ได้ใกล้กัน ลดขนาดโดยรวมของอุปกรณ์และประหยัดพื้นที่ ซึ่งเป็นสิ่งจำเป็นสำหรับโดรนที่มีข้อจำกัดด้านน้ำหนักและพื้นที่

2.ความทนทานและง่ายต่อการบำรุงรักษา: PCB ทำจากวัสดุคุณภาพสูงและมีชั้นป้องกัน ทำให้มีความทนทานและดูแลรักษาง่าย ลดต้นทุนในการซ่อมแซมและเปลี่ยนชิ้นส่วน

3.การจัดการสัญญาณที่ดีขึ้น: โดยเฉพาะอย่างยิ่งใน PCB แบบหลายชั้น ช่วยให้มีการเดินสายสัญญาณที่สั้นและแม่นยำ ลดการรบกวนทางแม่เหล็กไฟฟ้า (EMI) และเพิ่มความสมบูรณ์ของสัญญาณ (Signal Integrity)

ไลน์วงจร

![Screenshot 2025-05-27 123602](https://github.com/user-attachments/assets/3b76e069-e00b-4009-a503-0252fe26b7fc)

การจัดวางตำแหน่งอุปกรณ์ต่างๆ

![Screenshot 2025-05-27 123349](https://github.com/user-attachments/assets/f265c6ee-51b0-45f5-bc16-5ec752456a12)

PCB 3D
![Screenshot 2025-05-27 123416](https://github.com/user-attachments/assets/9be7fe32-a7f9-41f1-bcb3-f77b8ad9cf61)![Screenshot 2025-05-27 123438](https://github.com/user-attachments/assets/604a0848-293e-4aca-b4e3-48a5de3667ee)

##

## 4.เชื่อมต่อ RC Receiver

1.การเชื่อมต่อ: ตัวรับสัญญาณ RC Futaba เชื่อมต่อกับ STM32 F103 C8 T6 โดยใช้ STM32 for Arduino add-on มีการระบุการเชื่อมต่อของแต่ละช่องสัญญาณของตัวรับสัญญาณ (Channel 1 ถึง 6) เข้ากับพอร์ต PB10 ถึง PB15 ของ STM32

2.หลักการทำงานของสัญญาณ: แต่ละช่องสัญญาณของตัวรับสัญญาณจะส่งสัญญาณพัลส์ที่มีความยาวระหว่าง 1000 ถึง 2000 ไมโครวินาที ซึ่งความยาวของพัลส์จะแปรผันตามตำแหน่งของสติ๊กบนตัวส่งสัญญาณ ตำแหน่งกึ่งกลางจะอยู่ที่ประมาณ 1500 ไมโครวินาที, เลื่อนไปทางซ้ายสุดอยู่ที่ 1000 ไมโครวินาที และขวาสุดอยู่ที่ 2000 ไมโครวินาที

3.การใช้ Interrupt: ในการอ่านค่าพัลส์จากตัวรับสัญญาณขณะที่โปรแกรมควบคุมการบินทำงานอยู่ จะต้องใช้ Interrupt เพื่อหยุดการทำงานหลักชั่วคราวเมื่อเกิดสัญญาณพัลส์ Interrupt จะช่วยให้สามารถจับเวลาเริ่มต้นและสิ้นสุดของพัลส์ได้อย่างแม่นยำ

4.ปัญหาเรื่องเวลา (Millis และ Micros): การใช้ฟังก์ชัน millis() และ micros() บน STM32 for Arduino add-on มีขั้นตอนการทำงานที่ซับซ้อน และอาจให้ค่าที่ไม่ถูกต้องเมื่อเกิด Interrupt จากตัวรับสัญญาณ เนื่องจาก Interrupt ของตัวรับสัญญาณมีความสำคัญสูงกว่า Interrupt ที่ใช้ในการนับเวลา

5.ความไม่มีประสิทธิภาพของการจัดการ Interrupt เริ่มต้น: วิธีการจัดการ Interrupt พร้อมกันหลายช่องสัญญาณของตัวรับสัญญาณในไฟล์ XT.c นั้นไม่มีประสิทธิภาพ เนื่องจาก Interrupt Handler จะทำงานทีละช่องสัญญาณ ทำให้ใช้เวลานานในการอ่านค่าพัลส์ทั้งหมด

##

## 5.การควบคุมมอเตอร์และ ESC

1.การรับข้อมูลจากเซ็นเซอร์: Flight Controller (ในที่นี้คือ STM32F103C8T6) จะรับข้อมูลจากเซ็นเซอร์ต่างๆ เช่น Gyroscope (วัดการหมุน), Accelerometer (วัดความเร่งและการเอียง) และ Barometer (วัดความสูง) เพื่อรับรู้สถานะและตำแหน่งของโดรนแบบเรียลไทม์.

2.การประมวลผลด้วย PID Control: ข้อมูลจากเซ็นเซอร์จะถูกนำไปประมวลผลด้วยอัลกอริทึม PID (Proportional-Integral-Derivative) เพื่อคำนวณหาค่า "ข้อผิดพลาด" และกำหนดคำสั่งที่จำเป็นในการรักษาสมดุลหรือปรับเปลี่ยนทิศทางของโดรนตามคำสั่งของผู้ควบคุม.

3.การควบคุมมอเตอร์ (ESC): Flight Controller จะส่งสัญญาณ PWM (Pulse Width Modulation) ไปยัง Electronic Speed Controllers (ESCs) ซึ่งทำหน้าที่ควบคุมความเร็วของมอเตอร์แต่ละตัว การปรับความเร็วของมอเตอร์แต่ละตัวอย่างอิสระนี้เองที่ทำให้โดรนสามารถลอยตัว เคลื่อนที่ไปข้างหน้า ถอยหลัง เลี้ยว หรือเอียงตัวได้.

4.การสื่อสารกับรีโมทคอนโทรล: Flight Controller รับคำสั่งจากผู้ควบคุมผ่านตัวรับสัญญาณ RC (Receiver) ที่เชื่อมต่ออยู่ คำสั่งเหล่านี้จะถูกแปลงเป็นสัญญาณดิจิทัลเพื่อนำไปใช้ในการประมวลผลและควบคุมการบิน.

5.การรักษาเสถียรภาพและตำแหน่ง: ด้วยข้อมูลจาก GPS (ถ้ามี) และเซ็นเซอร์อื่นๆ Flight Controller สามารถรักษาตำแหน่ง (Position Hold) หรือรักษาระดับความสูง (Altitude Hold) รวมถึงการทำงานของระบบ Fail-safe เพื่อความปลอดภัยในกรณีที่สัญญาณขาดหายหรือแบตเตอรี่อ่อน.

##

## 6.การพัฒนา PID Controller สำหรับโดรน

การปรับค่าหลักๆจะมีค่า P I D เพื่อให้โดรนบินได้อย่างมีประสิทธิภาพ การหาค่ามีหลายวิธีแต่วิธีที่ใช้เป็นการปรับค่าจนเกิดความพึงพอใจ

![image](https://github.com/user-attachments/assets/1daf3237-6e2c-4958-ac3f-5e776c280e5f)
##

## 7.การเชื่อมต่อและสื่อสารไร้สายกับโดรน
1.ติดตั้ง STM32 ใน Arduino IDE: แสดงวิธีติดตั้ง Arduino IDE และเพิ่มบอร์ด STM32 เพื่อให้เขียนโปรแกรมได้

2.เชื่อมต่อบอร์ด: อธิบายการเชื่อมต่อ STM32 กับตัวโปรแกรม FTDI เพื่ออัปโหลดโปรแกรม

3.อัปโหลดโปรแกรม: การตั้งค่าและอัปโหลดโปรแกรมลง STM32 จาก Arduino IDE

4.ทดสอบความเร็ว: เปรียบเทียบความเร็ว STM32 กับ Arduino Uno แสดงให้เห็นว่า STM32 เร็วกว่า

##



